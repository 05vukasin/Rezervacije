<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurants</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Custom CSS -->
    <!-- Custom CSS -->
    <style>
        body {
            background-color: #2c2c2c;
            color: #fff;
        }

        .restaurant-card {
            margin-bottom: 20px;
            background-color: #3b3b3b;
            border: none;
            border-radius: 10px;
            transition: transform 0.2s ease-in-out;
        }

        .restaurant-card:hover {
            transform: scale(1.05);
        }

        .restaurant-header {
            display: flex;
            align-items: center;
            justify-content: start;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .restaurant-header h5 {
            margin-left: 10px;
            margin-bottom: 0;
            color: #2c2c2c;
            cursor: pointer;
        }

        .profile-image {
            margin: 10px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
        }

        .carousel-inner img {
            max-height: 260px;
            object-fit: cover;
            border-radius: 10px;
        }

        .carousel {
            background-color: #fff;
        }

        .no-images {
            background-color: #e0e0e0;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #7d7d7d;
        }

        .location {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
            padding: 10px;
            background-color: #cbc8c8;
            border-radius: 5px;
            color: #2c2c2c;
        }

        .location-icon {
            margin-right: 5px;
        }

        /* Responsive settings */
        @media (max-width: 768px) {
            .restaurant-card {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>

<div class="container mt-4">
    <h1 class="text-center mb-4">Restaurants</h1>

    <!-- Search bar -->
    <div class="input-group mb-4">
        <input type="text" id="searchBar" class="form-control" placeholder="Search for restaurants...">
        <button class="btn btn-primary" onclick="searchRestaurants()">Search</button>
    </div>

    <!-- Container for displaying restaurants -->
    <div id="restaurantsContainer" class="row"></div>
</div>

<!-- Bootstrap and JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const apiUrl = 'https://rezervacijeapi.azurewebsites.net/api/restaurants';
    const restaurantsContainer = document.getElementById('restaurantsContainer');

    // Fetch and display restaurants
    async function fetchRestaurants() {
        try {
            const response = await fetch(apiUrl);
            const restaurants = await response.json();
            displayRestaurants(restaurants);
        } catch (error) {
            console.error('Error fetching restaurants:', error);
        }
    }

    // Function to display restaurants and their images
    function displayRestaurants(restaurants) {
        restaurantsContainer.innerHTML = '';
        restaurants.forEach(restaurant => {
            const restaurantCard = document.createElement('div');
            restaurantCard.classList.add('col-md-4', 'restaurant-card');

            // Carousel for images or default background
            let carouselHtml = '';
            if (restaurant.slike && restaurant.slike.length > 0) {
                carouselHtml = `<div id="carousel${restaurant.restoranId}" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        ${restaurant.slike.map((slika, index) => `
                            <div class="carousel-item ${index === 0 ? 'active' : ''}">
                                <img src="${slika.slikaUrl}" class="d-block w-100" alt="Restaurant Image (ID: ${slika.slikaId})">
                            </div>
                        `).join('')}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel${restaurant.restoranId}" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carousel${restaurant.restoranId}" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>`;
            } else {
                carouselHtml = `<div class="no-images">No images available</div>`;
            }

            // Location (you can replace it with actual lat/long if available)
            const locationHtml = `
                <div class="location">
                    <div class="location-icon">
                        <i class="fa-solid fa-location-dot"></i>
                    </div>
                    <div>
                        ${restaurant.adresa || 'No address available'}
                    </div>
                </div>
            `;

            restaurantCard.innerHTML = `
                <div class="card shadow-sm">
                    <div class="restaurant-header" onclick="saveRestaurantId(${restaurant.restoranId})">
                        <img src="${restaurant.profilnaSlika || 'https://via.placeholder.com/80'}" class="profile-image" alt="${restaurant.naziv}">
                        <h5>${restaurant.naziv}</h5>
                    </div>
                    <div class="card-body">
                        ${carouselHtml}
                        <p class="card-text mt-3">${restaurant.adresa || 'No address available'}</p>
                        ${locationHtml}
                    </div>
                </div>
            `;

            restaurantsContainer.appendChild(restaurantCard);
        });
    }

    // Function to filter restaurants based on search term
    function searchRestaurants() {
        const searchTerm = document.getElementById('searchBar').value.toLowerCase();
        fetch(apiUrl)
            .then(response => response.json())
            .then(restaurants => {
                const filteredRestaurants = restaurants.filter(restaurant => 
                    restaurant.naziv.toLowerCase().includes(searchTerm) ||
                    restaurant.adresa.toLowerCase().includes(searchTerm)
                );
                displayRestaurants(filteredRestaurants);
            });
    }

    // Function to save restaurant ID to local storage and redirect to restoran.html
    function saveRestaurantId(restaurantId) {
        localStorage.setItem('selectedRestaurantId', restaurantId);
        window.location.href = 'restoran.html';
    }

    // Fetch and display restaurants on page load
    fetchRestaurants();
</script>
</body>
</html>
